<html>

<!-- these 4 files always have to be included -->
<link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css"/>


<script type="text/javascript" src="../../lib/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>

<script type="text/javascript" src="../../socket.io/socket.io.js"></script>

<link rel="stylesheet" type="text/css" href="./lib/css/jsgrid.css"/>
<link rel="stylesheet" type="text/css" href="./lib/css/jsgrid-theme.css"/>
<script type="text/javascript" src="./lib/js/jsgrid.js"></script>
<script type="text/javascript" src="./lib/js/grid.locale-de.js"></script>
<script type="text/javascript" src="./lib/js/grid.locale-ru.js"></script>


<!-- these two file always have to be included -->
<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
<script type="text/javascript" src="../../js/translate.js"></script>
<script type="text/javascript" src="../../js/adapter-settings.js"></script>
<script type="text/javascript" src="words.js"></script>
<style>
    .dialog-config {
        overflow: hidden !important;
    }

    .ui-tabs-panel {
        height: calc(100% - 70px);
        padding: 0 !important;
    }

    .table_header {
        background-color: blue;
        color: white;
    }

    .ip {
        width: 150px;
        text-align: right;
    }

    .ui-jqgrid-titlebar {
        display: none;
    }

    .ui-jqgrid-bdiv {
        overflow-x: hidden !important;
    }

    .ui-button-text-only .ui-button-text {
        padding: .3em !important;
    }

    .s7_tab {
        /*overflow: hidden;*/
        position: relative;
        height: calc(100% - 20px);
        width: 100%;
    }

    .s7_grid {
        height: 100% !important;
        width: 100% !important;
    }

    .jsgrid-grid-body {
        height: calc(100% - 58px) !important;
    }

    .jsgrid-table {
        width: 100% !important;
        font-size: 1em;
    }

    .jsgrid-insert-mode-button {
        display: none;
    }

    /*.jsgrid-edit-row input {
        padding: 0;
    }*/
    .jsgrid-table td {
        padding: 0.2em 0.2em !important;
        overflow: hidden;
    }

    .table_head_btn {
        text-align: center;
        font-size: 1.1em;
        position: absolute;
        z-index: 99;
        right: 5px;
        top: -27px;
    }

    .back_image {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        z-index: 0;
        opacity: 0.3;
    }

    .logo {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
        color: rgb(0, 153, 153);
        font-weight: bolder;
        font-size: 39px;
        padding: 9px;
        font-family: sans-serif;
    }

    #adapter-container {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-drag: none;
        user-select: none;
    }
</style>

<!-- you have to define 2 functions in the global scope: -->
<script type="text/javascript">
    var onChange  = null;
    var activePage = '';

    function tsap2input(input) {
        var val = $('#' + input).val();

        var val1 = (val >> 8).toString(16);
        if (val1.length === 1) val1 = '0' + val1;
        $('#' + input + '0').val(val1).on('change', function () {
            var v = $(this).val();
            if (v.toString().length > 2) $(this).val(v.substring(0,2));
            onChange();

            $('#' + input).val(((parseInt($('#' + input + '0').val(), 16) & 0xFF) << 8) + (parseInt($('#' + input + '1').val(), 16) & 0xFF));
        }).on('keyup', function() {
            $(this).trigger('change');
        });

        val1 = (val & 0xFF).toString(16);
        if (val1.length === 1) val1 = '0' + val1;
        $('#' + input + '1').val(val1).on('change', function () {
            var v = $(this).val();
            if (v.toString().length > 2) $(this).val(v.substring(0,2));
            $('#' + input).val(((parseInt($('#' + input + '0').val(), 16) & 0xFF) << 8) + (parseInt($('#' + input + '1').val(), 16) & 0xFF));
            onChange();
        }).on('keyup', function() {
            $(this).trigger('change');
        })
    }

    function getExport(data, id, delimiter) {
        delimiter = delimiter || '\t';
        var text;
        if (id === 'dbs') {
            text = 'DB'     + delimiter + 'Byte'    + delimiter + 'Bit' + delimiter;
        } else {
            text = 'Byte'   + delimiter + 'Bit'     + delimiter;
        }
        text +=
            'Name'          + delimiter +
            'Description'   + delimiter +
            'Type'          + delimiter +
            'Length'        + delimiter +
            'Unit'          + delimiter +
            'Role'          + delimiter +
            'Room'          + delimiter +
            'poll'          + delimiter +
            'RW'            + delimiter +
            'WP'            + '\n';

        for (var i = 0; i < data[id].length; i++) {
            var p;
            if (id === 'dbs') {
                p = data[id][i].Address.trim().match(/^DB(\d+)\s\+?(\d+)(.\d+)?$/i);
                if (p) {
                    text += p[1] + delimiter + (p[2] || 0) + delimiter + (data[id][i].Type === 'BOOL' ? (p[3] || '0').replace('.', '') : '') + delimiter;
                } else {
                    text += data[id][i].Address + delimiter;
                }
            } else {
                p = data[id][i].Address.trim().match(/^\+?(\d+)(.\d+)?$/);
                if (p) {
                    text += p[1] + delimiter + (p[2] || '') + delimiter;
                } else {
                    text += data[id][i].Address + delimiter;
                }
            }
            text += (data[id][i].Name || '') + delimiter;
            text += (data[id][i].Description || '') + delimiter;
            text += data[id][i].Type + delimiter;
            text += (data[id][i].Length || '') + delimiter;
            text += (data[id][i].Unit || '') + delimiter;
            text += (data[id][i].Role || '') + delimiter;
            text += (data[id][i].Room || '') + delimiter;
            text += (data[id][i].poll ? 'true' : 'false') + delimiter;
            text += (data[id][i].RW ? 'true' : 'false') + delimiter;
            text += (data[id][i].WP ? 'true' : 'false') + delimiter;
            text += '\n';
        }
        return text;
    }

    function getImport(data, id, text) {
        var delimiter;
        if (text.indexOf('\t') !== -1) {
            delimiter = '\t';
        } else if (text.indexOf(';') !== -1) {
            delimiter = ';';
        } else {
            delimiter = ' ';
        }
        var lines = text.split('\r\n');
        if (lines.length === 1) {
            lines = text.split('\n');
            if (lines.length === 1) {
                lines = text.split('\r');
            }
        }
        for (var i = 0; i < lines.length; i++) {
            var parts = lines[i].split(delimiter);
            if (parts.length === 1) {
                continue;
            }
            if (parseInt(parts[0].trim(), 10).toString() !== parts[0]) continue;
            var obj = {};
            if (id === 'dbs') {
                if (parts[5].toLowerCase() === 'bool') {
                    obj.Address = 'DB' + parts[0].trim() + ' ' + parts[1].trim() + '.' + parts[2];
                } else {
                    obj.Address = 'DB' + parts[0].trim() + ' ' + parts[1].trim();
                }
                parts.splice(0, 1);
            } else {
                if (parts[4].toLowerCase() === 'bool') {
                    obj.Address = parts[0].trim() + '.' + parts[1];
                } else {
                    obj.Address = parts[0].trim();
                }
            }
            obj.Name        = parts[2].trim() || '';
            obj.Description = parts[3].trim() || '';
            obj.Type        = parts[4].trim() || '';
            obj.Length      = parts[5].trim() || '';
            if (obj.Length !== '') {
                obj.Length = parseInt(obj.Length, 10);
            }
            obj.Unit        = parts[6].trim() || '';
            obj.Role        = parts[7].trim() || '';
            obj.Room        = parts[8].trim() || '';
            obj.poll        = parts[9].trim() || '';
            obj.RW          = parts[10].trim() || '';
            obj.WP          = parts[11].trim() || '';
            obj.poll        = (obj.poll.toLowerCase() === 'true' || obj.poll === '1' || obj.poll === '+');
            obj.RW          = (obj.RW.toLowerCase()   === 'true' || obj.RW   === '1' || obj.RW   === '+');
            obj.WP          = (obj.WP.toLowerCase()   === 'true' || obj.WP   === '1' || obj.WP   === '+');
            data[id].push(obj);
        }
        $('#s7_' + id).jsGrid('render');
    }

    function load(settings, onchange) {
        var $btn = $('#btn_loadSymbols');
        $btn.button({
            label: _($btn.data('title')) || ''
        }).on('click', function () {
            $('#file_symbol_import').trigger('click')
        });

        $btn = $('#btn_loaddb');
        $btn.button({
            label: _($btn.data('title')) || ''
        }).on('click', function () {
            $('#file_db_import').trigger('click')
        });

        $btn = $('.btn_toggle_pool');
        $btn.button({
            label: _($btn.data('title')) || ''
        }).on('click', function (e, ui) {
            var grid = $(this).parent().data('grid');
            var $grid = $('#' + grid);
            var localData = $grid.jsGrid('option', 'data');
            $.each(localData, function () {
                this.poll = !this.poll;
            });

            $grid.jsGrid('option', 'data', localData);
            onChange();
        });


        $btn = $('.btn_toggle_rw');
        $btn.button({
            label: _($btn.data('title')) || ''
        }).on('click', function () {
            var grid = $(this).parent().data('grid');
            var $grid = $('#' + grid);
            var localData = $grid.jsGrid('option', 'data');
            $.each(localData, function () {
                this.RW = !this.RW;
            });

            $grid.jsGrid('option', 'data', localData);
            onChange();
        });

        $btn = $('.btn_toggle_wp');
        $btn.button({
            label: _($btn.data('title')) || ''
        }).on('click', function () {
            var grid = $(this).parent().data('grid');
            var $grid = $('#' + grid);
            var localData = $grid.jsGrid('option', 'data');

            $.each(localData, function () {
                this.WP = !this.WP;
            });

            $grid.jsGrid('option', 'data', localData);
            onChange();

        });

        $('#adapter-container').tabs({
            activate: function (event, ui) {
                switch(ui.newPanel.selector) {
                    case '#s7_tab_g':
                        activePage = 0;
                        break;
                    case '#s7_tab_i':
                        activePage = 1;
                        break;
                    case '#s7_tab_o':
                        activePage = 2;
                        break;
                    case '#s7_tab_m':
                        activePage = 3;
                        break;
                    case '#s7_tab_d':
                        activePage = 4;
                        break;
                    default:
                        activePage = 0;
                        break;
                }
                if (typeof localStorage !== 'undefined') {
                    localStorage['s7page'] = activePage.toString();
                }
            }
        });

        if (systemLang === 'de') translate_de();
        if (systemLang === 'ru') translate_ru();

        if (typeof localStorage !== 'undefined') {
            activePage = localStorage['s7page'];
            $('#adapter-container').tabs({active: parseInt(activePage || 0, 10)});
        }

        var data = {
            inputs:  settings.inputs   || [],
            outputs: settings.outputs  || [],
            markers: settings.markers  || [],
            counter: settings.counter  || [],
            timer:   settings.timer    || [],
            dbs:     settings.dbs      || [],
            params:  settings.params   || {
                ip:         '192.168.0.1',
                rack:       0,
                slot:       2,
                poll:       1000,
                recon:      60000,
                pulstime:   1000,
                round:      2,
                localTSAP:  0,
                remoteTSAP: 0
            }
        };

        onChange = onchange;

        $.each($('.s7_params'), function () {
            var id = $(this).attr('id');
            if ($(this).hasClass('check')) {
                if (data.params[id.split('_')[1]]) {
                    document.getElementById(id).checked = data.params[id.split('_')[1]];
                }
            } else {
                $(this).val(data.params[id.split('_')[1]]);
            }

            if (id === 's7params_remoteTSAP' || id === 's7params_localTSAP') {
                tsap2input(id);
            }

            $(this).on('change', function () {
                onchange();
            }).on('keyup', function () {
                $(this).trigger('change');
            });
        });

        $('#s7params_timeFormat').on('change', function () {
            var val = $(this).val();
            if (val === 'summer' || val === 'offset') {
                $('.time-offset').show();
                $('#s7params_timeOffset').val(0);
            } else {
                $('.time-offset').hide();
            }
        }).trigger('change');

        var $logo = $('#s7logo');
        $logo.on('change', function () {
            onchange();
            if ($(this).prop('checked')) {
                $('.logoS7').show();
                $('.realS7').hide();
                $('#s7params_remoteTSAP0').val('02').trigger('change');
                $('#s7params_remoteTSAP1').val('00').trigger('change');
                $('#s7params_localTSAP0').val('02').trigger('change');
                $('#s7params_localTSAP1').val('00').trigger('change');
            } else {
                $('#s7params_remoteTSAP0').val('00').trigger('change');
                $('#s7params_remoteTSAP1').val('00').trigger('change');
                $('#s7params_localTSAP0').val('00').trigger('change');
                $('#s7params_localTSAP1').val('00').trigger('change');
                $('.realS7').show();
                $('.logoS7').hide();
            }
        });

        if (data.params.remoteTSAP || data.params.localTSAP) {
            $logo.prop('checked', true);
            $('.logoS7').show();
            $('.realS7').hide();
        } else {
            $('.logoS7').hide();
            $('.realS7').show();
        }

        getEnums('rooms', function (err, rooms) {
            $.each($('.s7_grid'), function () {
                var _id = $(this).attr('id');

                var type_items = [
                    {value: 'BOOL',     text: 'BOOL',     roleRO: 'state',  roleRW: 'switch'},
                    {value: 'BYTE',     text: 'BYTE',     roleRO: 'value',  roleRW: 'level'},
                    {value: 'WORD',     text: 'WORD',     roleRO: 'value',  roleRW: 'level'},
                    {value: 'DWORD',    text: 'DWORD',    roleRO: 'value',  roleRW: 'level'},
                    {value: 'INT',      text: 'INT',      roleRO: 'value',  roleRW: 'level'},
                    {value: 'DINT',     text: 'DINT',     roleRO: 'value',  roleRW: 'level'},
                    {value: 'REAL',     text: 'REAL',     roleRO: 'value',  roleRW: 'level'},
                    {value: 'S7STRING', text: 'S7STRING', roleRO: 'string', roleRW: 'string'},
                    {value: 'STRING',   text: 'STRING',   roleRO: 'string', roleRW: 'string'},
                    {value: 'ARRAY',    text: 'ARRAY',    roleRO: '',       roleRW: ''},
                    {value: 'REAL',     text: 'REAL',     roleRO: 'value',  roleRW: 'level'},
                    {value: 'S5TIME',   text: 'S5TIME',   roleRO: 'value.interval', roleRW: 'level.interval'},
                    {value: 'S7TIME',   text: 'S7TIME',   roleRO: 'value.time', roleRW: 'value.time'}
                ];

                var role_items = [
                    {value: '',                     text: ''},
                    {value: 'value',                text: 'value'},
                    {value: 'level',                text: 'level'},
                    {value: 'state',                text: 'state'},
                    {value: 'switch',               text: 'switch'},
                    {value: 'value.temperature',    text: 'value.temperature'},
                    {value: 'value.humidity',       text: 'value.humidity'},
                    {value: 'value.brightness',     text: 'value.brightness'},
                    {value: 'value.battery',        text: 'value.battery'},
                    {value: 'value.valve',          text: 'value.valve'},
                    {value: 'value.time',           text: 'value.time'},
                    {value: 'value.interval',       text: 'value.interval'},
                    {value: 'button',               text: 'button'},
                    {value: 'indicator',            text: 'indicator'},
                    {value: 'level.dimmer',         text: 'level.dimmer'},
                    {value: 'level.valve',          text: 'level.valve'},
                    {value: 'level.blind',          text: 'level.blind'},
                    {value: 'level.temperature',    text: 'level.temperature'},
                    {value: 'level.interval',       text: 'level.interval'}
                ];

                var room_items = [{value: '', text: ''}];
                for (var room in rooms) {
                    if (rooms.hasOwnProperty(room)) {
                        room_items.push({value: room, text: rooms[room].common.name || room.substring('enum.rooms.'.length)});
                    }
                }

                var g = $('#' + _id).jsGrid({
                    width:      'auto',
                    height:     'auto',
                    inserting:  true,
                    editing:    true,
                    sorting:    true,
                    heading:    true,
                    paging:     false,
                    data:       data[_id.split('_')[1]],
                    fields: [
                        {name: 'Address'    , title:  _('Address'),       type: 'text',       width: '110px', sorter: function (a, b) {
                            var p;
                            if (a[0] === 'D' || a[0] === 'd') {
                                p = a.trim().match(/^DB(\d+)\s\+?(\d+)(.\d+)?$/);
                                if (p) {
                                    a = (parseInt(p[1], 10) || 0) * 100000 + (parseInt(p[2], 10) || 0) + parseInt((p[3] || '0').replace('.', ''), 10) / 8;
                                }
                            } else {
                                p = a.trim().match(/^\+?(\d+)(.\d+)?$/);
                                if (p) {
                                    a = (parseInt(p[1], 10) || 0) + parseInt((p[2] || '0').replace('.', ''), 10) / 8;
                                }
                            }
                            if (b[0] === 'D' || b[0] === 'd') {
                                p = b.trim().match(/^DB(\d+)\s\+?(\d+)(.\d+)?$/);
                                if (p) {
                                    b = (parseInt(p[1], 10) || 0) * 100000 + (parseInt(p[2], 10) || 0) + parseInt((p[3] || '0').replace('.', ''), 10) / 8;
                                }
                            } else {
                                p = b.trim().match(/^\+?(\d+)(.\d+)?$/);
                                if (p) {
                                    b = (parseInt(p[1], 10) || 0) + parseInt((p[2] || '0').replace('.', ''), 10) / 8;
                                }
                            }

                            return a === b ? 0 : (a > b ? 1 : -1);
                        }},
                        {name: 'Name'       , title:  _('Name'),          type: 'text',       width: '150px'},
                        {name: 'Description', title:  _('Description'),   type: 'text',       width: '250px'},
                        {name: 'Type'       , title:  _('Type'),          type: 'select',     width: '95px',  items: type_items, valueField: 'value', textField: 'text'},
                        {name: 'Length'     , title:  _('Length'),        type: 'text',       width: '40px', sorter: 'number'},
                        {name: 'Unit'       , title:  _('Unit'),          type: 'text',       width: '50px'},
                        {name: 'Role'       , title:  _('Role'),          type: 'select',     width: '100px', items: role_items, valueField: 'value', textField: 'text'},
                        {name: 'Room'       , title:  _('Room'),          type: 'select',     width: '100px', items: room_items, valueField: 'value', textField: 'text'},
                        {name: 'poll'       , title:  _('poll'),          type: 'checkbox',   width: '35px'},
                        {name: 'RW'         , title:  _('RW'),            type: 'checkbox',   width: '35px'},
                        {name: 'WP'         , title:  _('WP'),            type: 'checkbox',   width: '35px'},
                        {                                                 type: 'control',    width: '80px'}
                    ],
                    editRowRenderer: function(item) {
                        var $result = $('<tr>').addClass(this.editRowClass);

                        this._eachField(function(field) {
                            $('<td>').addClass(field.css)
                                    .appendTo($result)
                                    .append(field.editTemplate ? field.editTemplate(item[field.name], item) : '')
                                    .width(field.width || 'auto').keypress(function (e) {
                                        if (e.which === 13) {
                                            $('#' + _id).jsGrid('updateItem');
                                        }
                                        onchange();
                                    });
                        });
                        return $result;
                    },
                    onItemDeleted:   function (/* obj */) {
                        onchange();
                    },
                    onItemUpdated:   function (obj) {
                        /* {grid, row, item, itemIndex, previousItem}*/
                        var changed = false;
                        if ((obj.item.RW || obj.item.WP) && !obj.item.poll) {
                            obj.item.poll = true;
                            changed = true;
                        }
                        if (!obj.item.Role) {
                            for (var t = 0; t < type_items.length; t++) {
                                if (type_items[t].value == obj.item.Type) {
                                    obj.item.Role = !obj.item.RW ? type_items[t].roleRO : type_items[t].roleRW;
                                    changed = true;
                                    break;
                                }
                            }
                        }
                        if (obj.item.Type === 'BOOL') {
                            if (obj.item.Address.indexOf('.') === -1) {
                                obj.item.Address += '.0';
                                changed = true;
                            }
                        }
                        if (obj.item.Type !== 'STRING' && obj.item.Type !== 'S7STRING' && obj.item.Type !== 'ARRAY') {
                            if (obj.item.Length || obj.item.Length === 0) {
                                obj.item.Length = '';
                                changed = true;
                            }
                        }
                        if (obj.item.Type === 'S5TIME') {
                            if (!obj.item.Unit) {
                                obj.item.Unit = _('sec');
                                changed = true;
                            }
                        }
                        if (obj.item.Type === 'S7STRING' || obj.item.Type === 'STRING' || obj.item.Type === 'ARRAY') {
                            obj.item.Length = parseInt(obj.item.Length, 10) || 32;
                            if (obj.item.Length.toString() !== parseInt(obj.item.Length, 10).toString() || !parseInt(obj.item.Length, 10)) {
                                obj.item.Length = 32;
                                changed = true;
                            }
                        }
                        if (changed) this.render();//$('#' + _id).jsGrid('render');

                        onchange();
                    },
                    onItemInserting: function (obj) {
                        obj.item.poll = true;
                        // find automatically next address
                        var id = obj.grid._body.parent().attr('id').split('_')[1];
                        if (data[id].length) {
                            var max = 0;
                            if (id === 'dbs') {
                                var db = data[id][data[id].length - 1].Address.match(/^DB(\d+)\s*/);
                                if (db) {
                                    db = db[1];
                                } else {
                                    db = 1;
                                }
                                obj.item.Type   = data[id][data[id].length - 1].Type;
                                obj.item.Length = data[id][data[id].length - 1].Length;
                                obj.item.RW     = data[id][data[id].length - 1].RW;
                                obj.item.WP     = data[id][data[id].length - 1].WP;

                                for (var aa = 0; aa < data[id].length; aa++) {
                                    var len = 0;
                                    var _db = data[id][aa].Address.match(/^DB(\d+)\s*/);
                                    if (!_db ||_db[1] != db) continue;
                                    var address = data[id][aa].Address.match(/^DB\d+\s\+?([\d.]+)$/);
                                    if (address) address = address[1];

                                    if (data[id][aa].Type === 'BOOL') {
                                        len = 1/8;
                                        var parts_ = address.split('.');
                                        address = parseInt(parts_[0], 10) + ((parseInt(parts_[1], 10) || 0) / 8);
                                    } else if (data[id][aa].Type === 'BYTE') {
                                        len = 1;
                                        address = parseInt(address, 10);
                                    } else
                                    if (data[id][aa].Type === 'WORD'  || data[id][aa].Type === 'INT'  || data[id][aa].Type === 'S5TIME') {
                                        len = 2;
                                        address = parseInt(address, 10);
                                    } else
                                    if (data[id][aa].Type === 'DWORD' || data[id][aa].Type === 'DINT' || data[id][aa].Type === 'REAL') {
                                        len = 4;
                                        address = parseInt(address, 10);
                                    } else
                                    if (data[id][aa].Type === 'S7TIME') {
                                        len = 8;
                                        address = parseInt(address, 10);
                                    } else
                                    if (data[id][aa].Type === 'ARRAY' || data[id][aa].Type === 'STRING' || data[id][aa].Type === 'S7STRING') {
                                        len = data[id][aa].Length;
                                        address = parseInt(address, 10);
                                    }
                                    if (address + len > max) max = address + len;
                                }
                                if (obj.item.Type !== 'BOOL') {
                                    obj.item.Address = 'DB' + db + ' ' + Math.ceil(max);
                                } else {
                                    obj.item.Address = 'DB' + db + ' ' + Math.floor(max) + '.' + (max - Math.floor(max)) * 8;
                                }
                            } else {
                                obj.item.Type   = data[id][data[id].length - 1].Type;
                                obj.item.Length = data[id][data[id].length - 1].Length;
                                obj.item.RW     = data[id][data[id].length - 1].RW;
                                obj.item.WP     = data[id][data[id].length - 1].WP;

                                for (var a = 0; a < data[id].length; a++) {
                                    var len_ = 0;
                                    var address_ = parseInt(data[id][a].Address, 10);

                                    if (data[id][a].Type === 'BOOL') {
                                        len_ = 1/8;
                                        var parts = data[id][a].Address.split('.');
                                        address_ = parseInt(parts[0], 10) + ((parseInt(parts[1], 10) || 0) / 8);
                                    } else if (data[id][a].Type === 'BYTE') {
                                        len_ = 1;
                                    } else
                                    if (data[id][a].Type === 'WORD'  || data[id][a].Type === 'INT'  || data[id][a].Type === 'S5TIME') {
                                        len_ = 2;
                                    } else
                                    if (data[id][a].Type === 'DWORD' || data[id][a].Type === 'DINT' || data[id][a].Type === 'REAL') {
                                        len_ = 4;
                                    } else
                                    if (data[id][a].Type === 'S7TIME') {
                                        len_ = 8;
                                    } else
                                    if (data[id][a].Type === 'ARRAY' || data[id][a].Type === 'STRING' || data[id][a].Type === 'S7STRING') {
                                        len_ = data[id][a].Length;
                                    }
                                    if (address_ + len_ > max) max = address_ + len_;
                                }
                                if (obj.item.Type !== 'BOOL') {
                                    obj.item.Address = Math.ceil(max);
                                } else {
                                    obj.item.Address = Math.floor(max) + '.' + (max - Math.floor(max)) * 8;
                                }
                            }
                        } else {
                            if (id === 'dbs') {
                                obj.item.Address = 'DB1 0';
                            } else {
                                obj.item.Address = '0.0';
                            }
                            obj.item.Type = 'BOOL';
                        }

                        onchange();
                    }
                });
                g.data('JSGrid')._editRow = function($row) {
                    if(this._editingRow) {
                        this.updateItem();
                    }

                    var item = $row.data('JSGridItem');
                    var $editRow = this._createEditRow(item);

                    this._editingRow = $row;
                    $row.hide();
                    $editRow.insertAfter($row);
                    $row.data('JSGridEditRow', $editRow);
                };

                // add custom titles
                $('.jsgrid-header-sortable').each(function () {
                    if ($(this).text() === _('poll')) {
                        $(this).attr('title', _('Enable polling of data point'));
                    }
                    if ($(this).text() === _('RW')) {
                        $(this).attr('title', _('Write access allowed'));
                    }
                    if ($(this).text() === _('WP')) {
                        $(this).attr('title', _('Write pulses (true=>false edge)'));
                    }
                });
            });
        });

        $('.btn_export').button({
            icons: {primary: 'ui-icon-circle-minus'},
            text: false
        })
            .attr('title', _('Export to CSV'))
            .css({width: 24, height: 24})
            .on('click', function () {
                var id = $(this).data('table');
                // build text
                var text = getExport(data, id);
                $('#export-dlg').show();
                $('#export_textarea').val(text).focus().select();
                document.execCommand('copy');
            });

        $('#export-dlg').on('click', function () {
            $(this).hide();
        });

        $('.btn_import').button({
            icons: {primary: 'ui-icon-circle-plus'},
            text: false
        })
                .attr('title', _('Import from CSV'))
                .css({width: 24, height: 24})
                .on('click', function () {
                    $('#import_textarea').val('').focus();
                    $('#import-dlg').show().data('table', $(this).data('table'));
                });

        $('#import_button_ok').button({
            icons: {primary: 'ui-icon-check'},
            text: _('Export')
        }).on('click', function () {
            getImport(data, $('#import-dlg').hide().data('table'), $('#import_textarea').val());
            onchange();
        });
        $('#import_button_cancel').button({
            icons: {primary: 'ui-icon-close'},
            text: _('Close')
        }).on('click', function () {
            $('#import-dlg').hide();
        });

        $('.btn_delete_all').button({
            icons: {primary: 'ui-icon-trash'},
            text: false
        })
            .attr('title', _('Delete all entries'))
            .css({width: 24, height: 24})
            .on('click', function () {
                if (window.confirm(_('All entries will be deleted. Are you sure?'))) {
                    var grid = $(this).parent().data('grid');
                    var $grid = $('#' + grid);
                    var localData = $grid.jsGrid('option', 'data');
                    if (localData.length) {
                        localData.splice(0, localData.length);
                        $grid.jsGrid('render');
                        onchange();
                    }
                }
        });

        onchange(false);
    }

    function save(callback) {

        var obj = {
            params: {}
        };

        $.each($('.s7_grid'), function () {
            var id = $(this).attr('id');
            var key = id.split('_')[1];

            if ($(this).data('JSGrid')._editingRow) {
                $(this).jsGrid('updateItem');
            }
            obj[key] = $(this).jsGrid('option', 'data');
        });

        $.each($('.s7_params'), function () {
            var id = $(this).attr('id').split('_')[1];
            if ($(this).hasClass('check')) {
                obj.params[id] = document.getElementById($(this).attr('id')).checked;
            } else {
                obj.params[id] = $(this).val();
            }
            if (id === 'remoteTSAP' || id === 'localTSAP') obj.params[id] = parseInt(obj.params[id], 10);
        });
        callback(obj);
    }

    function symbolImport(e) {
        $('#btn_loadSymbols').button('option', 'disabled', true);
        var reader = new FileReader();

        reader.onload = function (e) {
            var localData = {
                inputs:  [],
                outputs: [],
                markers: []
//                counter: [],
//                timer: [],
//                dbs: []
            };
            var text = reader.result;

            text = text.split('126,');
            $.each(text, function () {
                var typ = this.slice(23, 29).replace(/( )/g, '');

                var d = {
                    Name:         this.slice(0, 23).replace(/( ){2,}/g, ''),
                    Address:      this.slice(29, 36).replace(/( )/g, ''),
                    Type:         this.slice(36, 41).replace(/( )/g, ''),
                    Description:  this.slice(46, 126).replace(/( ){2,}/, ''),
                    Unit:         '',
//                    Role:         '',
//                    Room:         '',
                    poll:         true,
                    RW:           false,
                    WP:           false
                };

//                    if (typ == 'E' || typ == 'EB' ||typ == 'EW' ||typ == 'ED'||typ == 'PEB'||typ == 'PEW'||typ == 'PED')data.inputs.push(d);
//                    if (typ == 'A' || typ == 'AB' ||typ == 'AW' ||typ == 'AD'||typ == 'PAB'||typ == 'PAW'||typ == 'PAD')data.outputs.push(d);
                if (typ === 'E' || typ === 'EB' || typ === 'EW' || typ === 'ED') localData.inputs.push(d);
                if (typ === 'A' || typ === 'AB' || typ === 'AW' || typ === 'AD') localData.outputs.push(d);
                if (typ === 'M' || typ === 'MB' || typ === 'MW' || typ === 'MD') localData.markers.push(d);
//                if (typ == 'C')data.counter.push(d);
//                if (typ == 'T')data.timer.push(d);
//                if (typ == 'DB')data.dbs.push(d);
            });

            $.each($('.s7_grid'), function () {
                if ($(this).attr('id') !== 's7_dbs') {
                    var id = $(this).attr('id');
                    var subDb = localData[id.split('_')[1]];
                    $('#' + id).jsGrid('option', 'data', subDb);
                    data[id] = subDb;
                }
            });

            onChange();
            var $file = $('#file_symbol_import');
            $file.replaceWith($file.clone());
            $('#btn_loadSymbols').button('option', 'disabled', false);
        };

        reader.readAsText(e[0], 'ISO-8859-1');
    }

    function dbImport(e) {
        $('#btn_loaddb').button('disable');

        var reader = new FileReader();

        reader.onload = function (e) {
            setTimeout(function () {
                var text       = reader.result;
                var $s7DBs     = $('#s7_dbs');
                var $s7input   = $('#s7_inputs');
                var $s7outputs = $('#s7_outputs');
                var $s7markers = $('#s7_markers');
                var changes  = {
                    inputs: false,
                    outputs: false,
                    markers: false,
                    dbs: false
                };
                var newParts = {
                    inputs:     $s7input.jsGrid('option',   'data') || [],
                    outputs:    $s7outputs.jsGrid('option', 'data') || [],
                    markers:    $s7markers.jsGrid('option', 'data') || [],
                    dbs:        $s7DBs.jsGrid('option',     'data') || []
                };

                if (text.indexOf('Leseanforderung') !== -1) {
                    // Graphpic format
                    var lines = text.replace(/\r\n/g, '\n').split('\n');
                    var mapping = {
                        'Name':             {attr: 'Name'},
                        'Typ':              {attr: ''},
                        'Operand':          {attr: 'Address',       process: function (f) {
                            // DB 504.DBW 1462 => DB504 1462
                            f = f.trim();
                            var db     = f.match(/^DB (\d+)/);
                            if (!db) {
                                // M
                                // MB
                                var m = f.match(/^MB? (\d+)\.?(\d+)?$/);
                                if (m) {
                                    return 'M ' + parseInt(m[1], 10) + (m[2] !== undefined ? '.' + m[2] : '');
                                } else {
                                    m = f.match(/^AB? (\d+)\.?(\d+)?$/);
                                    if (m) {
                                        return 'OUT ' + parseInt(m[1], 10) + (m[2] !== undefined ? '.' + m[2] : '');
                                    } else {
                                        m = f.match(/^EB? (\d+)\.?(\d+)?$/);
                                        if (m) {
                                            return 'IN ' + parseInt(m[1], 10) + (m[2] !== undefined ? '.' + m[2] : '');
                                        } else {
                                            return f;
                                        }
                                    }
                                }
                            }

                            var offset = f.match(/(\d+).?(\d+)?$/);
                            if (db && offset) {
                                return 'DB' + db[1] + ' ' + offset[1] + (offset[2] !== undefined ? '.' + offset[2] : '');
                            } else {
                                return f;
                            }
                        } },
                        'SPS-Format':       {attr: 'Type',          process: function (f) {return f;} },
                        'Byteanzahl':       {attr: 'Length',        process: function (f) {return parseInt(f, 10);} },
                        'Zugriff':          {attr: 'RW',            process: function (f) {return f !== 'read';} },
                        'Leseanforderung':  {attr: 'poll',          process: function (f) {return f === 'zyklisch';} },
                        'AktZeit (ms)':     {attr: ''},
                        'Kommentar':        {attr: 'Description'},
                        'Clients (Anzahl)': {attr: ''}
                    };
                    // First line
                    // "Name","Typ","Operand","SPS-Format","Byteanzahl","Zugriff","Leseanforderung","AktZeit (ms)","Kommentar","Clients (Anzahl)"
                    var sFields = lines[0].split(',');
                    // create mapping
                    var fields = [];
                    for (var m = 0; m < sFields.length; m++) {
                        sFields[m] = sFields[m].replace(/"/g, '');
                        fields.push(mapping[sFields[m]]);
                    }
                    for (var l = 1; l < lines.length; l++) {
                        lines[l] = lines[l].trim();
                        if (!lines[l]) continue;
                        sFields = lines[l].trim().split(',');
                        var obj = {
                            Type:           'ARRAY',
                            Unit:           '',
                            Role:           '',
                            Room:           '',
                            poll:           true,
                            RW:             false,
                            WP:             false
                        };
                        for (var f = 0; f < fields.length; f++) {
                            if (!fields[f].attr) continue;
                            if (!sFields[f]) {
                                console.log('error');
                                break;
                            }
                            sFields[f] = sFields[f].replace(/"/g, '');
                            obj[fields[f].attr] = fields[f].process ? fields[f].process(sFields[f]) : sFields[f];

                            if (obj.Name.match(/^@/)) {
                                obj = null;
                                break;
                            }
                        }
                        if (obj) {
                            if (obj.Type === 'BYTE' && obj.Length !== 1) {
                                obj.Type = 'ARRAY';
                            }
                            if (obj.Type === 'CHAR') {
                                obj.Type = 'STRING';
                            }
                            if (obj.Type === 'BYTE' || obj.Type === 'BOOL' || obj.Type === 'INT') {
                                obj.Length = '';
                            }
                            var _attr;
                            if (obj.Address.match(/^DB/)) {
                                _attr = 'dbs';
                            } else if (obj.Address.match(/^IN/)) {
                                obj.Address = obj.Address.replace(/^IN\s?/, '');
                                _attr = 'inputs';
                            } else if (obj.Address.match(/^OUT/)) {
                                _attr = 'outputs';
                                obj.Address = obj.Address.replace(/^OUT\s?/, '');
                            } else if (obj.Address.match(/^M/)) {
                                _attr = 'markers';
                                obj.Address = obj.Address.replace(/^M\s?/, '');
                            } else {
                                console.error('Unknown TYPE: ' + obj.Address);
                                continue;
                            }
                            // try to find same address
                            for (var aaa = 0; aaa < newParts[_attr].length; aaa++) {
                                if (newParts[_attr][aaa].Address === obj.Address) {
                                    newParts[_attr][aaa] = obj;
                                    changes[_attr] = true;
                                    obj = null;
                                    break;
                                }
                            }
                            if (obj) {
                                changes[_attr] = true;
                                newParts[_attr].push(obj);
                            }
                        }
                    }
                } else {
					var mm = text.match(/(DB)[0-9]+\s-\s/g);
                    var db = mm ? mm[0].replace(' - ', '') : '';
					var vv = text.split('STRUCT');

                    var struck = vv[1] ? vv[1].split('=')[0].split('\n') : [];

                    $.each(struck, function () {
                        if (this.length > 10) {
                            var x = this.split(/\s+/g);
                            x.shift();

                            var obj = {
                                Address:        db + ' ' + x.shift(),
                                Name:           x.shift(),
                                Type:           x.shift(),
                                dec:            x.shift(),
                                Description:    x.join(' '),
                                Unit:           '',
                                Role:           '',
                                Room:           '',
                                poll:           true,
                                RW:             false,
                                WP:             false
                            };

                            // try to find same address
                            for (var aaa = 0; aaa < newParts.dbs.length; aaa++) {
                                if (newParts.dbs[aaa].Address === obj.Address) {
                                    newParts.dbs[aaa] = obj;
                                    changes.dbs = true;
                                    obj = null;
                                    break;
                                }
                            }
                            if (obj) {
                                changes.dbs = true;
                                newParts.dbs.push(obj);
                            }
                        }
                    });
                }
                for (var attr in newParts) {
                    if (!newParts.hasOwnProperty(attr)) continue;
                    newParts[attr].sort(function (a, b) {
                        var aDB = a.Address.match(/^D?B?\s?(\d+)/);
                        var bDB = b.Address.match(/^D?B?\s?(\d+)/);
                        if (!aDB) return -1;
                        if (!bDB) return 1;
                        if (parseInt(aDB[1], 10) > parseInt(bDB[1], 10)) return 1;
                        if (parseInt(aDB[1], 10) < parseInt(bDB[1], 10)) return -1;
                        var aOffset = a.Address.match(/\s(\d+).?(\d+)?$/);
                        var bOffset = b.Address.match(/\s(\d+).?(\d+)?$/);
                        if (!aOffset) return -1;
                        if (!bOffset) return 1;
                        if (parseInt(aOffset[1], 10) > parseInt(bOffset[1], 10)) return 1;
                        if (parseInt(aOffset[1], 10) < parseInt(bOffset[1], 10)) return -1;
                        if (aOffset[2] === undefined && bOffset[2] !== undefined) return 1;
                        if (bOffset[2] === undefined && aOffset[2] !== undefined) return -1;
                        if (aOffset[2] === undefined && bOffset[2] === undefined) return 0;
                        if (parseInt(aOffset[2], 10) > parseInt(bOffset[2], 10)) return 1;
                        if (parseInt(aOffset[2], 10) < parseInt(bOffset[1], 10)) return -1;
                        return 0;
                    });
                }
                if (changes.dbs) {
                    $s7DBs.jsGrid('option',     'data', newParts.dbs);
                }
                if (changes.inputs) {
                    $s7input.jsGrid('option',   'data', newParts.inputs);
                }
                if (changes.outputs) {
                    $s7outputs.jsGrid('option', 'data', newParts.outputs);
                }
                if (changes.markers) {
                    $s7markers.jsGrid('option', 'data', newParts.markers);
                }
                var $file = $('#file_db_import');
                $file.replaceWith($file.clone());
                $('#btn_loaddb').button('enable');
                onChange();
            }, 200);
        };

        reader.readAsText(e[0], 'ISO-8859-1');
    }
</script>

<!-- you have to put your config page in a div with id adapter-container -->
<div id="adapter-container" style="height: calc(100% - 40px);width: calc(100% - 10px); overflow: hidden;  ">

    <ul>
        <li><a href="#s7_tab_g" class="translate">General</a></li>
        <li><a href="#s7_tab_i" class="translate">Inputs</a></li>
        <li><a href="#s7_tab_o" class="translate">Outputs</a></li>
        <li><a href="#s7_tab_m" class="translate">Marker</a></li>
        <!--<li><a href="#s7_tab_c">Counter</a></li>-->
        <!--<li><a href="#s7_tab_t">Timer</a></li>-->
        <li><a href="#s7_tab_d">DBs</a></li>
    </ul>
    <div id="s7_tab_g" style="display: flex;  align-items: center; flex-direction: column;overflow: auto" class="s7_tab">
        <div class="logo">SIEMENS S7</div>
        <img src="img/plc_back.png" class="back_image">

        <table class="ui-widget-content" style="z-index: 2;margin-top: 60px; border: 1px solid black; border-collapse: collapse; ">
            <tr style="border-bottom: 1px solid black;text-align: center " class="ui-widget-header">
                <td colspan="2" class="translate">PLC Connection:</td>
            </tr>
            <tr>
                <td style="width: 200px"><label class="translate" for="s7params_ip">PLC IP Address:</label></td>
                <td style="width: 200px"><input class="s7_params" id="s7params_ip"/></td>
            </tr>
            <tr>
                <td><label class="translate" for="s7logo">S7 LOGO!:</label></td>
                <td><input id="s7logo" type="checkbox"/></td>
            </tr>
            <tr class="realS7">
                <td><label class="translate" for="s7params_rack">PLC Rack:</label></td>
                <td><input class="s7_params" id="s7params_rack"/></td>
            </tr>
            <tr class="realS7">
                <td><label class="translate" for="s7params_slot">PLC Slot:</label></td>
                <td><input class="s7_params" id="s7params_slot"/></td>
            </tr>
            <tr class="logoS7">
                <td><label class="translate" for="s7params_localTSAP0">Local TSAP:</label></td>
                <td><input id="s7params_localTSAP0" maxsize="2" size="2"/><input id="s7params_localTSAP1" maxsize="2" size="2"/> <input class="s7_params" id="s7params_localTSAP" type="hidden"/></td>
            </tr>
            <tr class="logoS7">
                <td><label class="translate" for="s7params_remoteTSAP0">Remote TSAP:</label></td>
                <td><input id="s7params_remoteTSAP0" maxsize="2" size="2"/><input id="s7params_remoteTSAP1" maxsize="2" size="2"/> <input class="s7_params" id="s7params_remoteTSAP" type="hidden"/></td>
            </tr>
        </table>

        <table class="ui-widget-content" style="z-index: 2;margin-top: 20px;border-collapse: collapse; display: inline; border: 1px solid black;">
            <tr>
                <td style="text-align: center" colspan="3" class="ui-widget-header translate">General</td>
            </tr>

            <tr>
                <td><label class="translate" for="s7params_round" style="padding-right: 10px">Round Real to:</label></td>
                <td><input style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_round"/></td>
                <td></td>
            </tr>
            <tr>
                <td><label class="translate" for="s7params_poll">Poll delay:</label></td>
                <td><input style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_poll"/></td>
                <td style="padding-right: 20px">ms</td>
            </tr>
            <tr>
                <td><label class="translate" for="s7params_recon">Reconnect time:</label></td>
                <td><input style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_recon"/></td>
                <td>ms</td>
            </tr>
            <tr>
                <td><label class="translate" for="s7params_pulsetime">Pulse time:</label></td>
                <td><input style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_pulsetime"/></td>
                <td>ms</td>
            </tr>
            <tr>
                <td><label class="translate" for="s7params_timeFormat">S7 Time mode:</label></td>
                <td colspan="2"><select style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_timeFormat">
                    <option value="" class="translate">Local time</option>
                    <option value="utc" class="translate">UTC</option>
                    <option value="summer" class="translate">Offset (with day saving time)</option>
                    <option value="offset" class="translate">Offset (no day saving time)</option>
                </select></td>
            </tr>
            <tr class="time-offset">
                <td><label class="translate" for="s7params_timeOffset">Time offset:</label></td>
                <td><input style="margin-right: 5px;text-align: right" class="s7_params" id="s7params_timeOffset"/></td>
                <td><span class="translate">minutes</span></td>
            </tr>
        </table>

        <table class="ui-widget-content" style="z-index: 2;margin-top: 20px;  margin-bottom: 20px; border: 1px solid black; border-collapse: collapse; ">
            <tr class="ui-widget-header">
                <td style="width: 200px; text-align: center" class="translate">Import symbols file:</td>
                <td style="width: 200px; text-align: center" class="translate">Import DB file:</td>
            </tr>
            <tr>
                <td style="padding: 10px;width: 180px; text-align: center">
                    <button id="btn_loadSymbols"  data-title="Load Symbols"></button>
                    <input style="display: none" onchange="symbolImport(this.files)" type="file" accept=".asc" id="file_symbol_import"/></td>
                <td style="padding: 10px;width: 180px; text-align: center">
                    <button id="btn_loaddb"  data-title="Add DB"></button>
                    <input style="display: none" onchange="dbImport(this.files)" type="file" accept=".prn, .csv" id="file_db_import"/></td>
            </tr>
        </table>
    </div>
    <div id="s7_tab_i" class="s7_tab">
        <div class="table_head_btn" data-grid="s7_inputs">
            <button class="btn_delete_all" data-table="inputs"></button>
            <button class="btn_export" data-table="inputs"></button>
            <button class="btn_import" data-table="inputs"></button>
            <button class="btn_toggle_pool translateT" data-title="Toggle poll" title="Polling"></button>
            <button class="btn_toggle_rw translateT"   data-title="Toggle RW"   title="Write access"></button>
            <button class="btn_toggle_wp translateT"   data-title="Toggle WP"   title="write as Pulse"></button>
        </div>
        <div id="s7_inputs" class="s7_grid"></div>
    </div>
    <div id="s7_tab_o" class="s7_tab">
        <div class="table_head_btn" data-grid="s7_outputs">
            <button class="btn_delete_all "     data-table="outputs"></button>
            <button class="btn_export "         data-table="outputs"></button>
            <button class="btn_import "         data-table="outputs"></button>
            <button class="btn_toggle_pool "    data-title="Toggle poll"    title="Polling"></button>
            <button class="btn_toggle_rw "      data-title="Toggle RW"      title="Write access"></button>
            <button class="btn_toggle_wp "      data-title="Toggle WP"      title="write as Pulse"></button>
        </div>
        <div id="s7_outputs" class="s7_grid"></div>
    </div>
    <div id="s7_tab_m" class="s7_tab">
        <div class="table_head_btn" data-grid="s7_markers">
            <button class="btn_delete_all "     data-table="markers"></button>
            <button class="btn_export "         data-table="markers"></button>
            <button class="btn_import "         data-table="markers"></button>
            <button class="btn_toggle_pool "     data-title="Toggle poll"   title="Polling"></button>
            <button class="btn_toggle_rw "       data-title="Toggle RW"     title="Write access"></button>
            <button class="btn_toggle_wp "       data-title="Toggle WP"     title="write as Pulse"></button>
        </div>
        <div id="s7_markers" class="s7_grid"></div>
    </div>
    <!--<div id="s7_tab_c" style="overflow: auto">-->
    <!--<table id="s7_counter" class="s7_grid"></table>-->
    <!--<div id="pager-s7_counter"></div>-->
    <!--</div>-->
    <!--<div id="s7_tab_t" style="overflow: auto">-->
    <!--<table id="s7_timer" class="s7_grid"></table>-->
    <!--<div id="pager-s7_timer"></div>-->
    <!--</div>-->
    <div id="s7_tab_d" class="s7_tab">
        <div class="table_head_btn" data-grid="s7_dbs">
            <button class="btn_delete_all " data-table="dbs"></button>
            <button class="btn_export " data-table="dbs"></button>
            <button class="btn_import " data-table="dbs"></button>
            <button class="btn_toggle_pool " data-title="Toggle poll" title="Polling"></button>
            <button class="btn_toggle_rw "   data-title="Toggle RW" title="Write access"></button>
            <button class="btn_toggle_wp "   data-title="Toggle WP" title="write as Pulse"></button>
        </div>
        <div id="s7_dbs" class="s7_grid"></div>
    </div>
    <div id="export-dlg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;display: none; z-index: 100">
        <div id="export_help" class="translate" style="position: absolute; top: 10px; right: 10px; font-size: 24px; font-weight: bold; color: blue">Text copied to clipboard. Click to close the window</div>
        <textarea id="export_textarea" readonly style="width: 100%; height: 100%"></textarea>
    </div>
    <div id="import-dlg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;display: none; z-index: 100">
        <textarea id="import_textarea" style="width: 100%; height: calc(100% - 40px)"></textarea>
        <button id="import_button_ok"       style="position: absolute; bottom: 10px; right: 120px;" title="Import"></button>
        <button id="import_button_cancel"   style="position: absolute; bottom: 10px; right: 10px;"  title="Close"></button>
    </div>
</div>

</html>
